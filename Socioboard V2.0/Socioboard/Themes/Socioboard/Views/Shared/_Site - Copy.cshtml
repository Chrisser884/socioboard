@using Domain.Socioboard.Domain
@{
    Layout = null;
    string path = @System.Configuration.ConfigurationManager.AppSettings["domain"];
}

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">

<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="Socioboard" />
    <link rel="shortcut icon" href="/Themes/@path/Contents/img/ivon.ico" type="image/x-icon" />

    <title>SocioBoard</title>

    <!-- Bootstrap Core CSS -->
    <link href="../../Themes/@path/Contents/css/bootstrap.min.css" rel="stylesheet" />

    <!-- MetisMenu CSS -->
    @*<link href="/Themes/@path/Contents/css/plugins/metisMenu/metisMenu.min.css" rel="stylesheet">*@

    <!-- Timeline CSS -->
    <link href="/Themes/@path/Contents/css/plugins/timeline.css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link href="/Themes/@path/Contents/css/sb-admin-2.css" rel="stylesheet" />

    <!-- Morris Charts CSS -->
    @* <link href="/Themes/@path/Contents/css/plugins/morris.css" rel="stylesheet">*@

    <!-- Custom Fonts -->
    <link href="/Themes/@path/Contents/css/font-awesome.min.css" rel="stylesheet" type="text/css" />


    <!--datepicker css-->
    <link href="/Themes/Socioboard/Contents/css/datepicker.css" rel="stylesheet" />
    <link href="/Themes/Socioboard/Contents/css/datepicker3.css" rel="stylesheet" />


    <link href="/Themes/Socioboard/Contents/css/bootstrap-timepicker.min.css" rel="stylesheet" />
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="/Themes/@path/Contents/js/jquery-1.9.1.min.js"></script>
    <script src="/Themes/@path/Contents/js/Home.js" type="text/javascript"></script>

    @*Edited by Antima*@
    @*<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>*@

    <script src="/Themes/@path/Contents/js/alertify.min.js" type="text/javascript"></script>
    <script src="/Themes/@path/Contents/js/ads.js" type="text/javascript"></script>
    <link href="/Themes/@path/Contents/css/alertify.core.css" rel="stylesheet" type="text/css" />
    <link href="/Themes/@path/Contents/css/alertify.default.css" rel="stylesheet" type="text/css" id="toggleCSS" />
    <link href="/Themes/@path/Contents/css/plugins/dataTables.bootstrap.css" rel="stylesheet" type="text/css"/>
    <script src="/Themes/@path/Contents/js/clickDesk.js" type="text/javascript"></script>
     <!--Edit by Vikas-->
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/css/jasny-bootstrap.min.css">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jasny-bootstrap/3.1.3/js/jasny-bootstrap.min.js"></script>
</head>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-fixed-top" role="navigation" style="margin-bottom: 0">
            <div class="btn-group pull-right btn" id="groupsselection">
                @Html.Partial("_LoadGroupPartial")
            </div>
            @{ User objUser = (User)Session["User"];}
            <div class="pull-right" id="PremiumAccount"><a href="../PersonalSetting/Index">Get Premium Account<i class="fa fa-fw"></i></a></div>
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="../Home/Index">
                    <img src="/Themes/@path/Contents/img/logo.png" alt="Socio Board" style="
    margin-top: -14px;" /></a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                <li class="dropdown">
                    <a title="Home" class="active" href="../Home/Index"><i class="fa fa-home fa-2x"></i></a>
                </li>
                <li class="dropdown">
                    <a title="Search Contact" data-toggle="modal" data-target="#SearchModal" style="margin-top: 10px;cursor: pointer;" id="search_contact"><i class="fa fa-search fa-2x"></i></a>
                </li>
                <li class="dropdown">
                    <a title="Compose Message" data-toggle="modal" data-target="#myModal" style="margin-top: 10px;cursor: pointer;" id="compose_message"><i class="fa fa-pencil fa-2x"></i></a>
                </li>
                <li class="dropdown">
                        <a title="Groups" href="../Group/Index" style="margin-top: 10px;cursor: pointer;"><i class="fa fa-group fa-2x"></i></a>
                </li>
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-2x"></i><i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="../UserGroup/Index"><img src="/Themes/@path/Contents/img/groups_.png">User and Group<i class="fa arrow"></i></a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="../PersonalSetting/Index"><i class="fa fa-gear fa-2x"></i>Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="../Index/Logout"><i class="fa fa-sign-out fa-2x"></i>Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->



            <div class="navbar-default sidebar" role="navigation" id="left_sidebar">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li id="dashboard">
                            <a class="active" href="../Home/Index"><i class="fa fa-dashboard fa-2x"></i><span class="tweaked-margin">Dashboard</span></a>
                        </li>
                        <li id="message">
                            <a href="../Messages/Index"><i class="fa fa-envelope fa-2x"></i><span class="tweaked-margin">Messages</span><span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                    <a href="../Messages/Index">Smart Inbox</a>
                                </li>
                                <li>
                                    <a href="../Messages/Task">My Tasks</a>
                                </li>
                                <li>
                                    <a href="../Messages/sentmsg">Sent Messages</a>
                                </li>
                                <li>
                                    <a href="../Messages/Archive">Archived Messages</a>
                                </li>
                            </ul>
                            <!-- /.nav-second-level -->
                        </li>
                        <li id="feeds">
                            <a href="../Feeds/Index"><i class="fa fa-link fa-2x"></i><span class="tweaked-margin">Feeds</span><i class="fa arrow"></i></a>

                        </li>

                        <li id="publishing">
                            <a href="../Publishing/Index"><i class="fa fa-wrench fa-2x"></i><span class="tweaked-margin">Publishing</span><span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li id="scheduledmsg">
                                    <a href="../Publishing/Index">Schedule Messages</a>
                                </li>
                                <li id="socioqueue">
                                    <a href="../Publishing/Socioqueue">SocioQueue</a>
                                </li>
                                <li id="draft">
                                    <a href="../Publishing/Draft">Drafts</a>
                                </li>
                            </ul>
                            <!-- /.nav-second-level -->
                        </li>
                        <li id="discovery">
                            <a href="../Discovery/Index"><i class="fa fa-edit fa-2x"></i><span class="tweaked-margin">Discovery</span></a>
                        </li>
                        <li id="reports">
                            <a href="../Report/Index"><i class="fa fa-sitemap fa-2x"></i><span class="tweaked-margin">Reports</span><span class="fa arrow"></span></a>
                            @*<ul class="nav nav-second-level">
                                <li>
                                    <a href="#">Group Report</a>
                                </li>
                                <li>
                                    <a href="#">Twitter Report</a>
                                </li>
                                <li>
                                    <a href="#">Team Report</a>
                                </li>

                            </ul>*@
                            <!-- /.nav-second-level -->
                        </li>
                        <li id="group">
                            <a href="../Group/Index"><i class="fa fa-users fa-2x"></i><span class="tweaked-margin">Groups</span></a>

                            <!-- /.nav-second-level -->
                        </li>
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <!-- Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalLabel">New Message</h4>
                    </div>
                    <div class="modal-body col-md-12">
                        <div class="col-md-3">
                            @*  <img src="https://fbcdn-sphotos-b-a.akamaihd.net/hphotos-ak-xap1/t31.0-8/s960x960/1523017_786750101350785_664146563_o.jpg" alt="" class="img-circle" style="height: 80px; width: 80px;">
                            <hr class="small">*@
                            <!-- Split button -->
                            <div class="btn-group">
                                <button type="button" class="btn btn-warning">Profile</button>
                                <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown">
                                    <span class="caret"></span>
                                    <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu" role="menu" id="binduserinul">
                                    <li><a href="#">fb</a></li>
                                    <li><a href="#">tweeter</a></li>
                                    <li><a href="#">gplus</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-9">
                            @*<div class="input-group col-md-12">
                                <textarea rows="3" class="form-control" id="textareavaluetosendmessage" style="width: 390px; height: 100px;resize: none;"></textarea>
                            </div>*@
                            <div class="row">
                                <div class="input-group col-md-9" style="float: left;">
                                    <textarea id="textareavaluetosendmessage" class="form-control" rows="3" style="width: 390px; height: 100px;resize: none;"></textarea>
                                </div>
                                <div style="float: left; padding: 2px;" class="input-group col-md-3">
                                    <div id="messageCount" class="counter_bg"></div>
                                </div>

                                 @*Edited by Antima*@

                                  <div class="col-md-11 input-group custom-search-form">
                                    <input type="text" id="textareavaluetoshrinkUrl" class="form-control" placeholder="Write URL to shrink">
                                    <span class="input-group-btn">
                                        <button id="btn_URLShortened" class="btn btn-success" type="button">
                                            <i class="fa fa"></i>URL shrink
                                        </button>
                                    </span>
                                </div>
                            </div>


                            <div class="form-group">
                                <br />
                                <div id="showRemoveImage" class="upload_data btn btn-default btn-sm" style="background-color: rgb(34, 34, 34); border: 1px solid rgb(0, 0, 0); color: rgb(255, 255, 255); float: left; border-radius: 5px; margin-right: 6px; display: none;" onclick="RemoveImage()">
                                    <span style="float: right; margin-left: 5px"></span>
                                    <label style="float: right; font-size: small; display: block;">Remove Image x </label>
                                </div>
                                <div class="col-md-7 pull-right">
                                    <input type="file" id="fileuploadImage" name="" onchange="AddImageComposeMessage()" class="btn btn-default col-md-6" accept="image/*">
                                    <button class="btn btn-default col-md-5" id="btn_dropbox" style="margin-left: 10px;">Dropbox</button>
                                </div>
                            </div>
                        </div>
                        <div id="binduserprofiles">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="sendMessageBtn" type="button" class="btn btn-primary">Send</button>
                        <button id="closeMessaegBtn" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <div style="height: auto; display: none; padding: 10px; border: medium ridge; margin-top: 10px;" class="dropbox_file col-md-12"></div>
                    </div>

                </div>
            </div>
        </div>
        <!--end of model-->


        <!-- Modal SearchModal-->
        <div class="modal fade" id="SearchModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalLabel">Contact Search</h4>
                    </div>
                    <div class="modal-body">
                        <div class="input-group custom-search-form">
                            <input id="txtsearchcontact" type="text" class="form-control" placeholder="Enter Keyword or contact to search...">
                            <span class="input-group-btn">
                                <button id="btncontactsearch" class="btn btn-default" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                        </div>
                        <div class="chat-panel panel panel-default">

                             @*Edited by Antima*@
                           @* <div class="panel-heading">
                                <i class="fa fa-search fa-fw"></i>
                                Search Result
                            </div>*@

                            <div class="panel-heading" id="SearchContact">
                               
                            </div>

                            <!-- /.panel-heading -->
                            <div class="panel-body">
                                @* <button type="button" class="btn btn-primary btn-md btn-block"><i class="fa fa-facebook-square fa-2x fa-fw"></i><strong>Chanchal Santra</strong><i class="fa fa-clock-o fa-fw"></i></button>
                            <button type="button" class="btn btn-default btn-md btn-block"><i class="fa fa-linkedin-square fa-fw"></i>Chanchal Santra<i class="fa fa-clock-o fa-fw pull-right"></i></button>*@
                                <div class="well well-sm blue"><i class="fa fa-twitter"></i><b>twitter</b></div>
                                <div id="twittersearch">
                                </div>
                                <div class="well well-sm blue"><i class="fa fa-facebook-square fa-fw"></i><b>facebook</b></div>
                                <div id="facebooksearch">
                                </div>
                            </div>
                            <!-- /.panel-body -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--end of model-->


        @RenderBody();
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery Version 1.11.0 -->
    <script src="/Themes/@path/Contents/js/jquery-1.11.0.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/Themes/@path/Contents/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="/Themes/@path/Contents/js/plugins/metisMenu/metisMenu.js"></script>

    <!-- Morris Charts JavaScript -->
    <script src="/Themes/@path/Contents/js/plugins/morris/raphael.min.js"></script>
    <script src="/Themes/@path/Contents/js/plugins/morris/morris.min.js"></script>
    @*<script src="/Themes/@path/Contents/js/plugins/morris/morris-data.js"></script>*@
    @*<script src="https://raw.githubusercontent.com/dinbror/bpopup/master/jquery.bpopup.min.js"></script>*@

    <!-- Custom Theme JavaScript -->
    <script src="/Themes/@path/Contents/js/sb-admin-2.js"></script>
    <script src="../../Themes/@path/Contents/js/Message.js"></script>
    <script src="/Themes/Socioboard/Contents/js/bootstrap-datepicker.js"></script>
    <!-- DataTables JavaScript -->
    <script src="/Themes/Socioboard/Contents/js/jquery.dataTables.js"></script>
    <script src="/Themes/Socioboard/Contents/js/dataTables.bootstrap.js"></script>


    <script src="/Themes/Socioboard/Contents/js/bootstrap-timepicker.min.js"></script>
    <script src="../../Themes/@path/Contents/js/googleanalytics.js" type="text/javascript"></script>

    

    <script type="text/javascript">

        var arrbindusermaster = [];
        var re_url = '';
        function bindcomposemessagemaster() {
            $.ajax({
                type: 'POST',
                url: '../Home/ComposeMessage',
                success: function (msg) {
                    //alert(msg);
                    $('#binduserinul').html(msg);
                },
                async: false
            });


        };

        function checkisuserexistmaster(profileidwithnetwork) {
            if (jQuery.inArray(profileidwithnetwork, arrbindusermaster) === -1) {
                return false;
            }
            else {
                return true;
            }
        }

        function removebindfrofilesmaster(profileid, network) {
            $('#' + profileid).hide(250, function () {
                $('#' + profileid).remove();
            });
            var i = arrbindusermaster.indexOf(profileid + "~" + network);
            if (i != -1) {
                arrbindusermaster.splice(i, 1);
            }
            //arrbindusermaster.pop(profileid + "~" + network);
            //alert(profileid + "~" + network);
        }

        function bindfrofilesmaster(network, name, profileid) {
            var totalmessagewords = 0;
            if (checkisuserexistmaster(profileid + "~" + network) == false) {
                arrbindusermaster.push(profileid + "~" + network);
                //alert(profileid + "~" + network);
                $('#binduserprofiles').append('<span style="display:none" class="pull-right btn btn-default bindprof userpictiny" onclick="removebindfrofilesmaster(\'' + profileid + '\',\'' + network + '\')" id=' + profileid + ' data-toggle="tooltip" data-placement="right" title="click to remove"><div class="delet_icon" onclick="removebindfrofilesmaster(\'' + profileid + '\',\'' + network + '\')" style="margin-left: 83px;"></div><i class="fa fa-' + network + ' fa-fw"></i>' + name + '</span>');
                $('#' + profileid).fadeIn(250);
                totalmessagewords = BindChracterAccordingProfile(network);
                $('#messageCount').html(totalmessagewords);


                $('#textareavaluetosendmessage').bind('keyup', function () {

                    debugger;
                    var totalmessagewords = 0;
                    var last = arrbindusermaster.slice(-1)[0]
                    var strarr = last.split('~');
                    var Network = strarr[1];

                    totalmessagewords = BindChracterAccordingProfile(Network);

                    var charactersUsed = $(this).val().length;

                    if (charactersUsed > totalmessagewords) {
                        charactersUsed = totalmessagewords;
                        $(this).val($(this).val().substr(0, totalmessagewords));
                    }

                    var charactersRemaining = totalmessagewords - charactersUsed;

                    $('#messageCount').html(charactersRemaining);

                });
            }
            else {
                alertify.set({ delay: 1000 });
                alertify.error('This Account Already Added')
            }

        };

        function removesearch(id) {
            $('#' + id).hide(750, function () {
                $('#' + id).remove();
            });
        }
        var networkAcceptLength = [{ name: "twitter", value: 140 }, { name: "linkedin", value: 600 }, { name: "facebook", value: 5000 }];
        function getnetworkMaxAcceptLength(network)
        {
            for (var i = 0; i < networkAcceptLength.length; i++)
            {
                if (networkAcceptLength[i].name == network)
                {
                    return networkAcceptLength[i].value;
                }
            }
        }

        function getMinAcceptLenfromArray()
        {
            var length = getnetworkMaxAcceptLength(arrbindusermaster[0].split('~')[1]);
            for (var i = 0; i < arrbindusermaster.length; i++)
            {
                var netlength =getnetworkMaxAcceptLength(arrbindusermaster[i].split('~')[1])
                if (length >parseInt(netlength))
                {
                    length = netlength;
                }
            }
            return length;

        }



        function BindChracterAccordingProfile(network) {
            var totalmessagewords = getnetworkMaxAcceptLength(network);
            if (arrbindusermaster.length == 0) {
                if (network == "facebook") {
                    totalmessagewords = 5000;
                }
                if (network == "twitter") {
                    totalmessagewords = 140;
                }
                if (network == "linkedin") {
                    totalmessagewords = 600;
                }
               
                
            }
            else
            {
                var maxlen = getnetworkMaxAcceptLength(network);
                var minlen = getMinAcceptLenfromArray();
                if (parseInt(maxlen) < parseInt(minlen)) {
                    totalmessagewords = maxlen;
                }
                else
                {
                    totalmessagewords = minlen;

                }
            }
            return totalmessagewords;
        }




        $(document).ready(function () {
            // alert('sitemaster');
            $('.close').click(function () {
                $('#txtsearchcontact').val('');
                $('#twittersearch').html('');
                $('#facebooksearch').html('');
                $('#SearchContact').html('');                            // Edited by Antima

            });


            bindcomposemessagemaster();
            $('.groupclk').click(function () {
                var groupid = $(this).attr('grpid');
                //alert(grpid);
                $('#groupsselection').removeClass('open');
                // return false;
                //var groupid = $("#groupsselection").val();
                $.ajax
           ({
               type: "POST",
               url: "../Home/ChangeGroup?groupid=" + groupid,
               data: '',
               contentType: "application/json; charset=utf-8",
               dataType: "html",
               success: function (msg) {
                   debugger;
                //   alert(msg);
                   //window.location = self.location;
                   location.reload(true);
               }
           });
            });
            function searchconcact(txtsearch) {
                debugger;
                $.ajax({
                    type: 'POST',
                    url: '../Home/ContactSearchFacebook?keyword=' + txtsearch,
                    success: function (msg) {
                        //alert(msg);
                        $('#facebooksearch').html(msg);
                    }
                });
                $.ajax({
                    type: 'POST',
                    url: '../Home/ContactSearchTwitter?keyword=' + txtsearch,
                    success: function (msg) {
                        //alert(msg);
                        $('#twittersearch').html(msg);
                    }
                });
            }

            // Edited by Antima

            $('#btncontactsearch').click(function () {
                //searchconcact($('#txtsearchcontact').val());

                var Tosearch = $('#txtsearchcontact').val();
                if (Tosearch != "") {
                    searchconcact(Tosearch);
                    var html = "<i class=\"fa fa-search fa-fw\"></i>Search Result";
                    $('#SearchContact').html('');
                    $('#SearchContact').append(html);
                }
                else {
                    alert('Please enter a contact to search');
                }
            });

            var message1 = "";

            $('#sendMessageBtn').click(function () {
                var message = '';
                var allprofiles = '';
                var curdate = new Date();
                var curdaatetimetime = (curdate.getMonth() + 1) + "/" + curdate.getDate() + "/" + curdate.getFullYear() + " " + curdate.getHours() + ":" + curdate.getMinutes() + ":" + curdate.getSeconds();
                var fileExtension = ['jpeg', 'jpg', 'png', 'gif', 'bmp'];
                var fd = new FormData();
                var filesimage = document.getElementById('fileuploadImage').files[0];
                if (filesimage != null) {
                    if (hasExtension('fileuploadImage', fileExtension)) {
                        fd.append('file', filesimage);
                    }
                    else {
                        alertify.set({ delay: 3000 });
                        alertify.error("File Extention is not current. Please upload any image file");
                        return;
                    }
                }
                if (arrbindusermaster.length < 1) {
                    alertify.set({ delay: 3000 });
                    alertify.error("Please Select atleast a Profile");
                    return;
                }


                // Edited by Antima

                if (message1 == "") {
                    message = $("#textareavaluetosendmessage").val().trim();
                }
                else {
                    var message = $("#textareavaluetosendmessage").val().trim();
                    message = message + " " + message1;
                }

              //  var message = $("#textareavaluetosendmessage").val().trim();
                for (var i = 0; i < arrbindusermaster.length; i++) {
                    allprofiles += arrbindusermaster[i] + "<:>";
                    //alert(arrbindusermaster[i]);
                }

                for (var i = 0; i < arrbindusermaster.length; i++) {
                    var account = arrbindusermaster[i];
                    var strarray = account.split('~');
                    var ProfileType = strarray[1];
                    if (ProfileType == 'facebook') {
                        if (message.length > 5000) {
                            alertify.error("Facebook Not Support more than 5000 characters");
                            return;
                        }
                    }
                    if (ProfileType == 'twitter')
                    {
                        if (message.length>140) {
                            alertify.error("Twitter Not Support more than 140 characters");
                            return;
                        }
                    }
                    if (ProfileType == 'linkedin') {
                        if (message.length > 600) {
                            alertify.error("Linkedin Not Support more than 600 characters");
                            return;
                        }
                    }
                    
                }

                // Get File path thru added by Dropbox
                try {
                    debugger;
                    var selected = [];
                    $('.dropbox_file input:checked').each(function () {
                        var src1 = $(this).parent().next().attr('src');
                        selected.push(src1);
                    });
                    if (selected != null && selected != 'undefined') {
                        fd.append('DropboxImg', selected.join(','));
                    }

                }
                catch (e) {

                }


                allprofiles = allprofiles.substr(0, allprofiles.length - 3);
                $('#myModal').modal('hide');
                $.ajax({
                    type: 'POST',
                    url: '../Home/ComposeMessageSend?message=' + encodeURIComponent(message) + '&allprofiles=' + allprofiles + '&curdaatetimetime=' + curdaatetimetime,
                    data: fd,
                    processData: false,
                    contentType: false,
                    success: function (data) {
                        alertify.set({ delay: 3000 });
                        alertify.success("Message Send Successfully");
                        $("#textareavaluetosendmessage").val('');
                        $('#showRemoveImage').css('display', 'none');
                        $('#fileuploadImage').val('');
                        $('#binduserprofiles').css('display', 'none');
                        $('#binduserprofiles').html('');
                        

                    }

                });


            });

            $('#closeMessaegBtn').click(function () {
                $("#textareavaluetosendmessage").val('');
                $('#showRemoveImage').css('display', 'none');
                $('#fileuploadImage').val('');
                $('#binduserprofiles').css('display', 'none');
                window.location.href = '../Home/Index';
            });

            $("#btn_dropbox").click(function () {
                debugger;
                DropBoxData();
            });

            // Edited by Antima

            $("#btn_URLShortened").click(function () {
                debugger;
                message = $("#textareavaluetoshrinkUrl").val().trim();

                //if (message != "") {
                //    $('#btn_URLShortened').attr('disabled', true);
                //}
                
                if (message.indexOf("www") > -1) {
                    var longUrl = message;
                    var shortUrl = $("#textareavaluetoshrinkUrl");
                    shortUrl.html("Loading...");
                    var defaults = {
                        version: '2.0.1',
                        login: 'avinash12verma',
                        apiKey: 'R_f4aefd23995c4455b90433d700b50a3c',
                        history: '0',
                        longUrl: longUrl
                    };

                    //Build the URL to query
                    var daurl = "http://api.bit.ly/shorten?"
                                        + "version=" + defaults.version
                                        + "&longUrl=" + defaults.longUrl
                                        + "&login=" + defaults.login
                                        + "&apiKey=" + defaults.apiKey
                                        + "&history=" + defaults.history
                                        + "&format=json&callback=?";

                    // Utilize the bit.ly API

                    $.ajax({

                        type: 'GET',
                        url: daurl,
                        dataType: "jsonp",
                        processData: false,
                        crossDomain: true,
                        success: function (data) {
                            debugger;
                            //    alert(data.results[longUrl].shortUrl);
                            message1 = data.results[longUrl].shortUrl.toString();
                            $("#textareavaluetosendmessage").append(message1);
                           
                            $("#textareavaluetoshrinkUrl").val('');
                        },
                        error: function (err) {
                            debugger;
                            alert("error");
                        }
                    });
                   // $("#textareavaluetosendmessage").append(message1);
                }
                else {
                    alert("please Check the URL you entered is correct");
                }

            });

        });

        function facebookpopup() {
            $('#facebookpopup').modal('show');
        }
        function linkedinpopup() {
            $('#linkedinpopup').modal('show');
        }

        function ytvideo(check) {
            $("#popupimagesyt").attr('src', 'https://localhost:9821');
            var arr = check.split('/');

            var videolink = arr[arr.length - 2];
            if (videolink == "img") {
                alert('opps video not found');
            }
            else {
                $("#popupimagesyt").attr('src', 'https://www.youtube.com/embed/' + videolink);
                $('#profileModal').modal('show');

                //$("#youtubeImagePopup").bPopup({
                //    positionStyle: 'fixed'
                //});
            }
        };

        function getfacebookpage() {
            $.ajax({
                type: 'POST',
                url: '../FacebookManager/AuthenticateFacebook?op=page',
                success: function (msg) {
                    window.location = msg;
                },
                async: false
            });
        }

        function getfacebookgroup() {
            $.ajax({
                type: 'POST',
                url: '../FacebookManager/AuthenticateFacebook?op=fbgroup',
                success: function (msg) {
                    window.location = msg;
                },
                async: false
            });
        }

        function getlinkedincompanypage() {
            $.ajax({
                type: 'POST',
                url: '../LinkedinManager/linPage_connect',
                success: function (msg) {
                    window.location = msg;
                },
                async: false
            });
        }

        function Addfacebookpagebyurl() {

            var texturl = $("#_txtinputurl").val();

            var url = texturl.split('com/')[1];

            var name = url;

            url = "https://graph.facebook.com/" + url;

            var type = "fanpage"

            $.ajax({
                type: 'POST',
                url: "../FacebookManager/Addfacebookpagebyurl?type=" + type + "&url=" + url + "&name=" + name,
                success: function (msg) {
                    window.location = msg;
                },
                async: false
            });



        }






        function DropBoxData() {
            $.ajax
                ({
                    type: "GET",
                    url: "../DropboxManager/DropBox",
                    contentType: "application/json; charset=utf-8",
                    dataType: "html",
                    success: function (msg) {
                        debugger
                        if (msg.indexOf('authorize') > 0) {
                            if (re_url != '') {
                                DropBoxData();
                            }
                            else {
                                re_url = msg;
                                var wnd = window.open(msg, "myWindowName", "width=500, height=600");
                                debugger;

                                var timepool = window.setInterval(function () {
                                    if (wnd.closed) {
                                        window.clearInterval(timepool);
                                        DropBoxData();
                                    } else {
                                        //alert("just refreshed");
                                    }
                                }, 500);

                            }
                        }
                        else {
                            $(".dropbox_file").html('');
                            $(".dropbox_file").css('display', 'block');
                            $(".dropbox_file").html(msg);
                        }
                    },
                    error: function (err) {
                        debugger;
                        alert(err);
                    }
                });

        }

        //----------vikash-----------//

        function AddImageComposeMessage() {
            debugger;
            var filesinput = $('#fileuploadImage');
            var fileExtension = ['jpeg', 'jpg', 'png', 'gif', 'bmp'];
            if (filesinput != undefined && filesinput[0].files[0] != null) {
                if (hasExtension('fileuploadImage', fileExtension)) {
                    $('#showRemoveImage').css('display', 'block');
                }
                else {
                    alertify.set({ delay: 3000 });
                    alertify.error("File Extention is not current. Please upload any image file");
                    $('#fileuploadImage').val('');
                    return;
                }

            }
        }

        function RemoveImage() {

            try {
                var filesinput = $('#fileuploadImage');

                debugger;

                if (filesinput !== 'undefined') {
                    $('#showRemoveImage').css('display', 'none');
                    document.getElementById('fileuploadImage').value = "";

                }
            } catch (e) {

            }
        }


    </script>

    <!-- ClickDesk Live Chat Service for websites -->
<script type='text/javascript'>
    var _glc = _glc || []; _glc.push('all_ag9zfmNsaWNrZGVza2NoYXRyDwsSBXVzZXJzGOqp7qkBDA');
    var glcpath = (('https:' == document.location.protocol) ? 'https://my.clickdesk.com/clickdesk-ui/browser/' :
    'http://my.clickdesk.com/clickdesk-ui/browser/');
    var glcp = (('https:' == document.location.protocol) ? 'https://' : 'http://');
    var glcspt = document.createElement('script'); glcspt.type = 'text/javascript';
    glcspt.async = true; glcspt.src = glcpath + 'livechat-new.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(glcspt, s);
</script>
<!-- End of ClickDesk -->

     @*Edited by Antima*@

    <script type="text/javascript">

        $('#txtsearchcontact').keypress(function (e) {
            debugger;
            var key = e.which;
            if (key == 13)  // the enter key code
            {
                $("#btncontactsearch").click();
            }
        });

    </script>

   @*  <script type="text/javascript">
        //Disable Back Button In All Browsers.
        function disableBackButtonAllBrowsers() {
            window.history.forward()
        };

        window.onload = disableBackButtonAllBrowsers();
        window.onpageshow = function (evts) {
            if (evts.persisted) {
                disableBackButtonAllBrowsers();
            }
        };

        window.onunload = function () {
            void (o)
        };

    </script>*@
</body>
<!-- ProfileModal -->
<div class="modal fade" id="profileModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Profile Summary</h4>
            </div>
            <div class="modal-body">
                <div class="embed-responsive embed-responsive-4by3">
                    <iframe id="popupimagesyt" class="embed-responsive-item" src="…"></iframe>
                </div>

            </div>

        </div>
    </div>
</div>


<div class="modal fade" id="facebookpopup" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                <h4 id="myModalLabel" class="modal-title">Add Account</h4>
            </div>
            <div class="modal-body col-md-12">

                <a style="cursor: pointer" href="../FacebookManager/AuthenticateFacebook">
                    <i class="fa fa-facebook-square fa-2x fa-fw"></i>Facebook account</a>

                <br />
                <br />
                <a style="cursor: pointer" onclick="getfacebookpage()">
                    <i class="fa fa-facebook-square fa-2x fa-fw"></i>Facebook FanPage</a>
                 <div class="panel-body">
                    <div id="facebookpageinfo" style="height: 200px; overflow: auto; border: 5px inset grey; padding: 3px; display: none">
                        <div id="fbpagebind" style="margin-top: 11px">
                        </div>
                    </div>
                </div>
                <br />
                <br />

                <a style="cursor: pointer">
                    <i class="fa fa-facebook-square fa-2x fa-fw"></i>
                    Add Facebook FanPage
                
                    <input id="_txtinputurl" type="text" placeholder="FanPage Url ex-http://www.facebook.com/socioboard">
                    <br />
                    <input type="submit" onclick="Addfacebookpagebyurl()">
                </a>
                <br />
                <br />

                <a style="cursor: pointer" onclick="getfacebookgroup()">
                    <i class="fa fa-facebook-square fa-2x fa-fw"></i>Facebook Group</a>
                <br />


                <div class="panel-body">
                    <div id="facebookgroupinfo" style="height: 200px; overflow: auto; border: 5px inset grey; padding: 3px; display: none">
                        <div id="fbgroupbind" style="margin-top: 11px">
                        </div>
                    </div>
                </div>

            </div>


            <div class="modal-footer">
                <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
            </div>
        </div>


    </div>
</div>


<div class="modal fade" id="linkedinpopup" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                <h4 id="myModalLabel" class="modal-title">Add Account</h4>
            </div>
            <div class="modal-body col-md-12">

                <a style="cursor: pointer" href="../LinkedinManager/AuthenticateLinkedin">
                    <i class="fa fa-linkedin-square fa-2x fa-fw"></i>Linkedin account</a>

                <br />
                <br />
                <a style="cursor: pointer" onclick="getlinkedincompanypage()">
                    <i class="fa fa-linkedin-square fa-2x fa-fw"></i>Linkedin Company Page</a>
                <br />
                <div class="panel-body">
                    <div id="linkedincompanypageinfo" style="height: 200px; overflow: auto;border: 5px inset grey;padding:3px;display:none">
                        <div id="lipagebind" style="margin-top:11px">
                        
                        </div>
                    </div>
                </div>

            </div>


            <div class="modal-footer">
                <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
            </div>
        </div>


    </div>
</div>

      <!-- Modal -->
                <div class="modal fade" id="ProfileDetail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                                <h4 class="modal-title" id="myModalLabel">Profile Summary</h4>
                            </div>
                            <div id="ProfileDetailBody" class="modal-body col-md-12">
                              @*  <div class="col-md-12" style="text-align: center; background: linear-gradient(to bottom, transparent 0px, rgba(0, 0, 0, 0.73) 100%) repeat scroll 0px 0px transparent; padding: 15px;">
                                    <img src="/Themes/@path/Contents/img/apple-touch-icon-72-precomposed.png" class="img-thumbnail" />
                                    <p><h2>abhay mondal</h2></p>
                                    <p>abhaymondal3</p>
                                    <p>iPhone6</p>
                                </div>
                                <div class="col-md-12">
                                    <ul class="list-inline">
                                        <li style="border-right: 1px solid #eeeeee;float: left;padding: 11px 7px 6px;text-align: center;width: 78px;">
                                            <a style="text-decoration:none;">
                                                <strong>73</strong>
                                                <span>Following</span>
                                            </a>
                                        </li>
                                        <li style="border-right: 1px solid #eeeeee;float: left;padding: 11px 7px 6px;text-align: center;width: 78px;">
                                            <a style="text-decoration:none;">
                                                <strong>15</strong>
                                                <span>Followers</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-12" style="text-align:center;">
                                    <a href="#">Go to full profile →</a>
                                </div>*@
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-danger " data-dismiss="modal">Close</button>

                            </div>
                        </div>
                    </div>
                </div>
                <!--end of model-->

<!--end of ProfileModel-->
</html>
